spec:
  component: [version]
  inputs:
    repo:
      description: The gitlab repo to affect
      default: $CI_PROJECT_URL
    token:
      description: The gitlab token to use. This token will need privileges to create MRs, tags, labels, and releases
    debug:
      description: Enables debug logs
      default: ""
    job_name:
      description: Customize the generated job name (default = release)
      default: release-pr
    job_stage:
      description: The stage in which to run the job
      default: .pre
---
"$[[ inputs.job_name ]]":
  image:
    name: rgonnella/releasaurus:$[[ component.version ]]
    entrypoint: [""]
  stage: $[[ inputs.job_stage ]]
  needs: []
  variables:
    RELEASAURUS_DEBUG: $[[ inputs.debug ]]
  resource_group: releasaurus
  interruptible: false
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH &&
        $CI_COMMIT_MESSAGE !~ /chore\(.+\):\srelease.+/
  script: releasaurus release-pr
    --gitlab-repo $[[ inputs.repo ]]
    --gitlab-token $[[ inputs.token ]]

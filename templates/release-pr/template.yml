spec:
  component: [name, version, reference]
  inputs:
    repo:
      description: The gitlab repo to affect
      default: $CI_PROJECT_URL
    token:
      description: The gitlab token to use. This token will need privileges to create MRs, tags, labels, and releases
    debug:
      description: Enables debug logs
      default: ""
    git_user_name:
      description: The git user name to use when committing and creating tags
      default: "ReleasaurusCI"
    git_user_email:
      description: The git user email to use when committing and creating tags
      default: releasaurus-ci@noreply.com
    job_name:
      description: Customize the generated job name (default = release)
      default: release-pr
---
"$[[ inputs.job_name ]]":
  image:
    name: rgonnella/releasaurus:$[[ component.version ]]
    entrypoint: [""]
  stage: .pre
  needs: []
  variables:
    RELEASAURUS_DEBUG: $[[ inputs.debug ]]
  resource_group: releasaurus
  interruptible: false
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH &&
        $CI_COMMIT_MESSAGE !~ /chore\(.+\):\srelease.+/
  script: |
    git config --global user.name "$[[ inputs.git_user_name ]]"
    git config --global user.email "$[[ inputs.git_user_email ]]"

    releasaurus release-pr \
      --gitlab-repo $[[ inputs.repo ]] \
      --gitlab-token $[[ inputs.token ]]
